<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Behavior Tracker</title>
    <script>
        const SHEET_ID = '1IzsOd5etK2tprEr3E2iDNeGs7-Url0Iq1d7a0AE4ud4';
        const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzKFNmzR_dGdhuu1vcva-al1KS22BAhplIqQZ72bAOSLYWELNxF94NeGRverA7uFTvHdg/exec';
        const SHEET_NAME = 'Students';

        async function fetchStudentData() {
            const url = WEB_APP_URL;
            try {
                const response = await fetch(url);
                const data = await response.json();
                updateUI(data);
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        async function updatePoints(student, type, change) {
            const response = await fetch(WEB_APP_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ name: student, type, change })
            });
            fetchStudentData();  // Refresh UI after update
        }

        function updateUI(values) {
            const container = document.getElementById('students');
            container.innerHTML = '';
            values.slice(1).forEach(row => {
                const [name, hearts, crystals, xp] = row;
                const studentDiv = document.createElement('div');
                studentDiv.classList.add('student');
                studentDiv.innerHTML = `
                    <img src="${name}.png" alt="${name}" class="student-img">
                    <p>${name}</p>
                    <div class="hearts">${renderIcons(hearts, '‚ù§Ô∏è', 'ü§ç')}</div>
                    <div class="crystals">${renderIcons(crystals, 'üî∑', '‚¨ú')}</div>
                    <p>XP: <span id="xp-${name}">${xp}</span></p>
                    <div class="xp-bar"><div class="xp-progress" style="width: ${(xp % 1000) / 10 || 100}%"></div></div>
                    <button onclick="updatePoints('${name}', 'xp', 100)">+100 XP</button>
                    <button onclick="updatePoints('${name}', 'xp', -100)">-100 XP</button>
                    <button onclick="updatePoints('${name}', 'hearts', 1)">+1 Heart</button>
                    <button onclick="updatePoints('${name}', 'hearts', -1)">-1 Heart</button>
                    <button onclick="updatePoints('${name}', 'crystals', 1)">+1 Crystal</button>
                    <button onclick="updatePoints('${name}', 'crystals', -1)">-1 Crystal</button>
                `;
                container.appendChild(studentDiv);
            });
        }

        function renderIcons(count, fullIcon, emptyIcon) {
            let icons = '';
            for (let i = 0; i < 5; i++) {
                icons += i < count ? fullIcon : emptyIcon;
            }
            return icons;
        }
    </script>
    <style>
        .student { text-align: center; margin: 20px; display: inline-block; }
        .student-img { width: 100px; height: 100px; border-radius: 50%; }
        .xp-bar { width: 100px; height: 10px; background: lightgray; border-radius: 5px; margin: 5px auto; position: relative; }
        .xp-progress { height: 100%; background: green; border-radius: 5px; }
    </style>
</head>
<body onload="fetchStudentData()">
    <h1>Classroom Behavior Tracker</h1>
    <div id="students"></div>
</body>
</html>
